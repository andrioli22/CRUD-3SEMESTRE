<!DOCTYPE html>
<html lang="pt">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Cadastramento de Empreiteiro - WeFix</title>
        <!-- Pra Colocar a logo na aba -->
        <link rel="icon" href="logo.png">
        <!-- Importando estilos do Bootstrap -->
        <link
        rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        />
    </head>
    <style>
        body {
            background-image: url('wallpaper.jpg');
            font-family: Verdana, sans-serif;
        }
        .container {
            border: 3px solid black;
        }
        td {
            word-wrap:break-word;
        }
    </style>
    <body style="background-color: #ffffff;">
        <!-- Cabeçalho -->
        <nav class="navbar navbar-expand-lg" style="background-color: #000000;">
            <a class="navbar-brand  text-white font-weight-bold" href="#">
                <!-- PNG da Logo aqui -->
                <img src="logo.png" width="30" height="30" class="d-inline-block align-top" alt="">
            </a>
            <!-- Lista de outros links do Site Contendo CRUD -->
            <div class="collapse navbar-collapse" id="navbar">
                <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                    <li class="nav-item active">
                        <!-- Link para o Inicio -->
                        <a class="nav-link"
                        href="#"
                        style="color: white;
                        font-weight: bold";
                        >Inicio <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                        <!-- Link para o Cadastro de Cliente -->
                        <a class="nav-link"
                        href="frontCliente.html"
                        style="color: white;
                        font-weight: bold";
                        >Cadastro de Cliente</a>
                    </li>
                    <li class="nav-item">
                        <!-- Link para o Cadastro de Equipe -->
                        <a class="nav-link"
                        href="frontEquipe.HTML"
                        style="color: white;
                        font-weight: bold";
                        >Cadastro de Equipe</a>
                    </li>
                    <li class="nav-item">
                        <!-- Link para o Cadastro de Profissional -->
                        <a class="nav-link"
                        href="frontProfissional.html"
                        style="color: white;
                        font-weight: bold";
                        >Cadastro de Profissional</a>
                    </li>
                    <li class="nav-item">
                        <!-- Link para a Criação de Portfólios -->
                        <a class="nav-link"
                        href="frontPortfolio.html"
                        style="color: white;
                        font-weight: bold";
                        >Portfólio</a>
                    </li>
                </ul>
                <!-- Barra de Pesquisa -->
                <form class="form-inline" onsubmit="event.preventDefault(); displayEmpreiteirosPorNome();">
                    <input class="form-control mr-sm-2" type="search" id="barraPesquisa" placeholder="Buscar...">
                    <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Buscar</button>
                </form>
            </div>
        </nav>
        <br>
        <div class="container bg-white" id="container">
            <!-- Formulário para adicionar/editar Empreiteiros -->
            <div class="title">
                <h1 class="text-center text-dark">CADASTRAMENTO DE EMPREITEIRO</h1>
                </div>
            <form id="empreiteiroForm" class="my-4">
                <div class="form-group">
                    <!-- Campo de Nome -->
                    <label for="nome">Nome Completo:</label>
                    <input
                    type="text"
                    id="nome"
                    class="form-control"
                    placeholder="Nome"
                    required
                    />
                </div>
                <div class="form-group">
                    <!-- Campo de Cpf -->
                    <label for="nome">Cpf:</label>
                    <input
                    type="number"
                    max="99999999999"
                    id="cpf"
                    class="form-control"
                    placeholder="Cpf"
                    required
                    />
                </div>
                <div class="form-group">
                    <!-- Campo de E-mail -->
                    <label for="email">Email:</label>
                    <input
                    type="email"
                    id="email"
                    class="form-control"
                    placeholder="Email@exemplo.com"
                    required
                    />
                </div>
                <div class="form-group">
                    <!-- Campo de Senha -->
                    <label for="senha">Senha:</label>
                    <input
                    type="password"
                    id="senha"
                    class="form-control"
                    placeholder="Senha"
                    required
                    />
                </div>
                <div class="form-group">
                    <!-- Campo de Endereço -->
                    <label for="endereco">Endereço:</label>
                    <textarea class="form-control"
                    id="endereco"
                    rows="3"
                    placeholder="Rua dos exemplos, Bairro exemplo..."
                    required></textarea>
                </div>
                <div class="form-group">
                    <!-- Campo de Especialidade -->
                    <label for="especialidade">Especialidade:</label>
                    <input
                    type="text"
                    id="especialidade"
                    class="form-control"
                    placeholder="ex: Engenheiro, Arquiteto... etc"
                    required
                    />
                </div>
                <div class="form-group">
                    <!-- Campo de Certificados -->
                    <label for="certificados">Certificados:</label>
                    <textarea class="form-control"
                    id="certificados"
                    rows="3"
                    placeholder="ex: Diploma em Graduação... etc"></textarea>
                </div>
                    <!-- Botão para Cadastrar-se -->
                    <button 
                    type="submit"
                    id="submitBtn" 
                    class="btn btn-outline-success my-2 my-sm-0"
                    >Cadastrar
                    </button>
                    <!-- Botão para Cancelar (Somente Visivel durante alteração) -->
                    <button
                    type="button"
                    id="cancelBtn"
                    class="btn btn-outline-danger my-2 my-sm-0"
                    style="display: none"
                    >Cancelar
                    </button>
            </form>
            <!-- Tabela para listar Empreiteiros -->
            <table class="table table-bordered table-hover" style="background-color: solid gray; border: 2px solid gray; table-layout: fixed;">
                <thead>
                <tr>
                <th style="border: 2px solid gray";>Nome</th>
                <th style="border: 2px solid gray";>Cpf</th>
                <th style="border: 2px solid gray";>E-mail</th>
                <th style="border: 2px solid gray";>Senha</th>
                <th style="border: 2px solid gray";>Endereço</th>
                <th style="border: 2px solid gray";>Especialidade</th>
                <th style="border: 2px solid gray";>Certificados</th>
                </tr>
                </thead>
                <tbody id="empreiteirosTable"></tbody>
            </table>
            <script>
                // Array para armazenar os Empreiteiros do servidor
                let empreiteiros = [];
                // Nome do Empreiteiro em edição
                let empreiteiroAtual = null;
    
                // Função para exibir Empreiteiros na tabela
                function displayEmpreiteiros() {
                    const tbody = document.getElementById("empreiteirosTable");
                    tbody.innerHTML = "";
                    empreiteiros.forEach((empreiteiro) => {
                        const row = document.createElement("tr");
                        row.innerHTML = `                    
                            <td style="border: 2px solid gray";>${empreiteiro.nome}</td>
                            <td style="border: 2px solid gray";>${empreiteiro.cpf}</td>
                            <td style="border: 2px solid gray";>${empreiteiro.email}</td>
                            <td style="border: 2px solid gray";>${empreiteiro.senha}</td>
                            <td style="border: 2px solid gray";>${empreiteiro.endereco}</td>
                            <td style="border: 2px solid gray";>${empreiteiro.especialidade}</td>
                            <td style="border: 2px solid gray";>${empreiteiro.certificados}</td>
                            <td style="border: 2px solid gray">
                                <button class="btn btn-info btn-sm"
                                onclick="editEmpreiteiro(${empreiteiro.cpf})">Alterar</button>
                                <button class="btn btn-danger btn-sm"
                                onclick="deleteEmpreiteiro(${empreiteiro.cpf})">Remover</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                }
                // Função para mostrar Empreiteiros caso seja procurado pela Barra de Pesquisa
                function displayEmpreiteirosPorNome() {
                    const tbody = document.getElementById("empreiteirosTable");
                    tbody.innerHTML = "";
    
                    // Obtenha o nome da barra de pesquisa
                    const nomePesquisa = document.getElementById("barraPesquisa").value;
    
                    // Filtrar Empreiteiros que têm o mesmo nome que o nome da pesquisa
                    const empreiteirosFiltrados = empreiteiros.filter(e => e.nome == nomePesquisa);
    
                    empreiteirosFiltrados.forEach((empreiteiro) => {
                        const row = document.createElement("tr");
                        row.innerHTML = `
                            <td style="border: 2px solid gray";>${empreiteiro.nome}</td>
                            <td style="border: 2px solid gray";>${empreiteiro.cpf}</td>
                            <td style="border: 2px solid gray";>${empreiteiro.email}</td>
                            <td style="border: 2px solid gray";>${empreiteiro.senha}</td>
                            <td style="border: 2px solid gray";>${empreiteiro.endereco}</td>
                            <td style="border: 2px solid gray";>${empreiteiro.especialidade}</td>
                            <td style="border: 2px solid gray";>${empreiteiro.certificados}</td>
                            <td style="border: 2px solid gray";>
                                <button class="btn btn-info btn-sm" onclick="editEmpreiteiro(${empreiteiro.cpf})">Alterar</button>                           
                                <button class="btn btn-danger btn-sm" onclick="deleteEmpreiteiro(${empreiteiro.cpf})">Remover</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                }
                // Função para carregar um Empreiteiro no formulário para edição
                function editEmpreiteiro(cpf) {
                    empreiteiroAtual = cpf;
                    const empreiteiro = empreiteiros.find((e) => e.cpf === cpf.toString());
                    document.getElementById("nome").value = empreiteiro.nome;
                    document.getElementById("cpf").value = empreiteiro.cpf;
                    document.getElementById("email").value = empreiteiro.email;
                    document.getElementById("senha").value = empreiteiro.senha;
                    document.getElementById("endereco").value = empreiteiro.endereco;
                    document.getElementById("especialidade").value = empreiteiro.especialidade;
                    document.getElementById("certificados").value = empreiteiro.certificados;
                    // Mostra o botão cancelar durante a edição
                    document.getElementById("cancelBtn").style.display = "inline-block";
                }
                // Função para remover Empreiteiro do servidor e atualizar a lista
                function deleteEmpreiteiro(cpf) {
                    fetch("http://localhost:3002/empreiteiros/" + cpf, {
                    method: "DELETE"
                    })
                    .then(() => {
                        empreiteiros = empreiteiros.filter((e) => e.cpf !== cpf.toString());
                        displayEmpreiteiros();
                    })
                    .catch((error) => console.error("Error:", error));
                }
                // Evento para lidar com o envio do formulário
                document
                .getElementById("empreiteiroForm")
                .addEventListener("submit", function (event) {
                event.preventDefault();
                // Coleta os valores do formulário
                const empreiteiro = {
                    cpf: document.getElementById("cpf").value,
                    nome: document.getElementById("nome").value,
                    email: document.getElementById("email").value,
                    senha: document.getElementById("senha").value,
                    endereco: document.getElementById("endereco").value,
                    especialidade: document.getElementById("especialidade").value,
                    certificados: document.getElementById("certificados").value,
                }; 
                if (empreiteiroAtual) {
                    // Se estiver editando
                    fetch("http://localhost:3002/empreiteiros/" + empreiteiroAtual, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(empreiteiro),
                    })
                    .then((response) => response.json())
                    .then((data) => {
                        console.log(data);
                        const index = empreiteiros.findIndex((e) => e.cpf === empreiteiroAtual.toString());
                        empreiteiros[index] = data;
                        displayEmpreiteiros();
                        // Limpa o formulário e reseta o empreiteiro em edição
                        document.getElementById("empreiteiroForm").reset();
                        empreiteiroAtual = null;
                        document.getElementById("cancelBtn").style.display = "none";
                    })
                    .catch((error) => console.error("Error:", error));
                } else {
                // Se for um novo empreiteiro
                fetch("http://localhost:3002/empreiteiros", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(empreiteiro),
                })
                .then((response) => response.json())
                .then((data) => {
                    empreiteiros.push(data);
                    displayEmpreiteiros();
                    document.getElementById("empreiteiroForm").reset();
                })
                .catch((error) => console.error("Error:", error));
                }
                });
                // Cancela a edição e limpa o formulário
                document
                .getElementById("cancelBtn")
                .addEventListener("click", function () {
                    empreiteiroAtual = null;
                    document.getElementById("empreiteiroForm").reset();
                    this.style.display = "none";
                });
                // Carrega empreiteiros do servidor ao carregar a página
                fetch("http://localhost:3002/empreiteiros/")
                .then((response) => response.json())
                .then((data) => {
                    empreiteiros = data;
                    displayEmpreiteiros();
                })
                .catch((error) => console.error("Error:", error));
            </script>
            <!-- Bibliotecas JS auxiliares (Bootstrap requer jQuery e Popper.js) -->
            <script
            src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
            <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
            <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        </div>
        </body>
    </html>
